# 🚀 公司内部标准：AI 辅助开发与代码审查指南 (SOP)

**制定目的：**
本指南旨在规范开发团队如何高效、安全地使用 AI 辅助工具（如 Cursor、Claude、Gemini 等）进行软件开发。所有项目必须严格遵守“先设计、后生成、再审查”的原则，以确保代码质量、系统安全性及架构的可维护性。

**💡 核心哲学：我们培养的是“程序设计师”，而非“打字员”。**
在 AI 时代，代码的生成效率已不再是瓶颈。公司要求所有开发人员将精力从“敲击键盘”转向“系统设计”与“业务洞察”：
* **90% 以上的代码**应当由 AI 生成。
* **100% 的架构设计、用户体验逻辑与业务价值**必须由人主导。

---

## 🛑 Stage 0：业务洞察与文档沉淀 (并行工作流)
**⚠️ 严禁死盯着屏幕干等 AI 生成代码！你必须掌握“AI 写代码，人写业务文档”的并行工作节奏。**

AI 开发的高效率极易导致“盲目生产代码”的陷阱。因此，本阶段的执行是强制性的：
1. **思考先行 (Pre-Coding)：** 在向下达核心架构与代码生成指令前，利用 AI 快速调研行业背景、业务逻辑与竞品优劣，在脑海中形成清晰的业务蓝图。
2. **知识沉淀 (并行作业)：** 利用 Cursor/Claude 大批量生成代码、执行重构或运行测试的“漫长等待时间”，同步撰写一份 **《业务逻辑见解文档》 (INSIGHTS.md)**。
3. **强制要求：** 必须在提交第一个 Pull Request (PR) 之前将 `INSIGHTS.md` 存入项目根目录。文档需解释清楚：这个系统的核心业务痛点是什么？你的架构设计和功能打算如何切实解决它？

---

## 第一阶段：基础设施与技术选型 (Infrastructure & Architecture)
**⚠️ 核心原则：你是导演，AI 是摄影师。禁止在未确认架构前直接让 AI 生成完整系统代码。**

1. **确定项目安全级别：**
   在项目启动前，必须界定项目属于 **Level 1 (内部普通)**、**Level 2 (公开/内部高权限)** 还是 **Level 3 (高风险/涉及资金)**（详见第五阶段）。

2. **决定架构模式：**
   明确项目使用的架构设计（例如 MVC 模式、前后端分离 SPA 或 微服务架构）。

3. **统一技术栈 (Tech Stack) 规范：**
   - **后端框架：** 必须在 **Node.js / Python / PHP** 之间选择。
   - **前端框架：** 允许使用主流技术（如 React, Vue, Next.js 等）。
     - **🚨 强制要求：** 项目负责人必须在项目工单或 README 中，**写下不少于 50 字的前端框架选择原因**，避免盲目追逐新技术。
   - **数据库：** 涉及核心业务/资金必须使用 PostgreSQL/MySQL；非结构化数据允许使用 MongoDB。

---

## 第二阶段：前端与界面生成 (UI/UX Generation)
**目标：利用 AI 快速构建视觉原型，与业务方对齐需求。**

1. **内部系统 - 无 Figma 设计图：** 允许使用 Claude Sonnet 结合 Tailwind/Bootstrap 快速生成 UI。必须先与需求方确认 User Flow。
2. **公开项目 - 有专属 Figma 设计图：** 严禁 AI“自由发挥”，最终视觉效果必须与设计图 100% 对齐。

---

## 🛠️ 第三阶段：AI 工具库使用规范 (When to use what?)

作为架构师，我们将通过合理调度以下“员工”，以达成 **90% 代码 AI 生成** 的战略目标：

### 👥 角色分工 (Team Roster)

| 员工名称 | 角色定位 | 核心适用场景 |
| :--- | :--- | :--- |
| **Cursor Auto** | **无情打字机** | 编写单一函数、自动补全、生成基础接口、快速修复报错。 |
| **Claude Sonnet** | **高级前端/重构专家** | 根据截图生成组件、大规模文件重构、编写标准业务逻辑。 |
| **Gemini 3 Pro** | **深思熟虑的架构师** | 处理超长上下文（如 API 文档）、排查深层逻辑 Bug（如并发）、架构与安全自查。 |

---

### 🧼 Context 卫生守则 (Context Hygiene)

为了保持响应质量，必须严格遵守以下守则，确保 AI 始终处于巅峰状态：

#### 1. 精准喂食 (Targeted Feeding)
* **原则：** 如果明确知道改动范围，**禁止**使用模糊的 `@Codebase`。
* **操作：** 优先使用 `@Files` 或 `@Code Selection`（选取特定代码段）。
* **底层逻辑：** 这能强迫 AI 在「全文理解」而非「Vector 碎片」上工作，答案会更准确。

#### 2. 对话断舍离 (Chat Hygiene)
* **原则：** 「一事一议，完事清场」。
* **操作：** 每个独立的 Task（例如：新增一个 API Endpoint）结束后，必须按 `Cmd+N` 开启新对话。
* **底层逻辑：** 避免旧的对话历史（History）拖慢 AI 速度并浪费 Token 额度。

> [!TIP]
> 保持 Context 的纯净度是 AI 生成代码质量的分水岭。

---

## 第四阶段：数据库与接口设计 (DB & API Design)
1. 开发者必须先规划实体关系图 (ER Diagram)，可使用 AI 辅助生成 SQL Schema。
2. 在编写核心逻辑前，必须先定义好前后端交互的 JSON 数据接口规范。

---

## 第五阶段：安全分级与代码审查 (Security & Code Review)
**⚠️ 开发纪律 (君子协定)：**
为了保持团队的高效与自由度，公司**未在系统层面锁定 main 分支**。但这代表着更高的责任：**绝对严禁任何人直接将代码 Push 到 main 分支。** 所有的代码合并必须通过 Pull Request (PR) 并等待自动化检查通过（显示绿勾）！

各级别审查要求如下：
- 🛡️ **Level 1 (低风险 - 内部普通工具)：**
  - **要求：** 必须通过 CI/CD 的代码格式化检查 (Prettier/ESLint/PHP_CodeSniffer) 及开源安全扫描 (如 Trivy, npm audit, PHPStan)。CI 通过后可自行 Merge。
- 🛡️ **Level 2 (中风险 - 公开资讯 / 内部高权限工具)：**
  - **要求：** 必须通过自动化检查，**并且**要求开发者使用 AI (Gemini/Claude) 进行边界条件辅助自查。涉及核心权限的 PR 需由同事进行 Peer Review。
- 🛡️ **Level 3 (高风险 - 涉及资金/极敏感数据)：**
  - **要求：** 在自动化与 AI 审查的基础上，**强制要求**所有涉及交易、扣费、并发处理的代码，必须由 Tech Lead 亲自进行人工 Code Review 并 Approve 后方可 Merge。
