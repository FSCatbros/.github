# 🚀 公司内部标准：AI 辅助开发与代码审查指南 (SOP)

**制定目的：**
本指南旨在规范开发团队如何高效、安全地使用 AI 辅助工具（如 Cursor、Claude、Gemini 等）进行软件开发。所有项目必须严格遵守“先设计、后生成、再审查”的原则，以确保代码质量、系统安全性及架构的可维护性。

**💡 核心哲学：我们培养的是“程序设计师”，而非“打字员”。**
在 AI 时代，代码的生成效率已不再是瓶颈。公司要求所有开发人员将精力从“敲击键盘”转向“系统设计”与“业务洞察”：
* **90% 以上的代码**应当由 AI 生成。
* **100% 的架构设计、用户体验逻辑与业务价值**必须由人主导。

---

## 🛑 Stage 0：深度学习与行业洞察 (Pre-Coding)
**⚠️ 在动手写任何代码（或让 AI 写代码）之前，你必须先成为该领域的“半个专家”。**

AI 开发的高效率会带来“盲目生产代码”的陷阱。因此，本阶段是强制性的：
1. **深度调研：** 利用 AI 对即将开发的行业背景、业务逻辑、竞品优劣进行深度调研。
2. **知识沉淀：** 在等待 AI 生成代码或运行测试的间隙，你必须撰写一份 **《业务逻辑见解文档》 (INSIGHTS.md)**。
3. **强制要求：** 必须在提交第一个 Pull Request (PR) 之前将 `INSIGHTS.md` 存入仓库。你需要解释清楚：这个系统的核心业务痛点是什么？你的架构和功能打算如何解决它？

---

## 第一阶段：基础设施与技术选型 (Infrastructure & Architecture)
**⚠️ 核心原则：你是导演，AI 是摄影师。禁止在未确认架构前直接让 AI 生成完整系统代码。**

1. **确定项目安全级别：**
   在项目启动前，必须界定项目属于 **Level 1 (内部普通)**、**Level 2 (公开/内部高权限)** 还是 **Level 3 (高风险/涉及资金)**（详见第五阶段）。

2. **决定架构模式：**
   明确项目使用的架构设计（例如 MVC 模式、前后端分离 SPA 或 微服务架构）。

3. **统一技术栈 (Tech Stack) 规范：**
   - **后端框架：** 必须在 **Node.js / Python / PHP** 之间选择。
   - **前端框架：** 允许使用主流技术（如 React, Vue, Next.js 等）。
     - **🚨 强制要求：** 项目负责人必须在项目工单或 README 中，**写下不少于 50 字的前端框架选择原因**，避免盲目追逐新技术。
   - **数据库：** 涉及核心业务/资金必须使用 PostgreSQL/MySQL；非结构化数据允许使用 MongoDB。

---

## 第二阶段：前端与界面生成 (UI/UX Generation)
**目标：利用 AI 快速构建视觉原型，与业务方对齐需求。**

1. **内部系统 - 无 Figma 设计图：** 允许使用 Claude Sonnet 结合 Tailwind/Bootstrap 快速生成 UI。必须先与需求方确认 User Flow。
2. **公开项目 - 有专属 Figma 设计图：** 严禁 AI“自由发挥”，最终视觉效果必须与设计图 100% 对齐。

---

## 第三阶段：AI 工具库使用规范 (When to use what?)
请将自己视为架构师，合理调度以下“员工”以达成 **90% 代码 AI 生成** 的目标：

1. **Cursor Auto：** 你的“无情打字机”。用于编写单一函数、自动补全、生成基础接口、快速修复报错。
2. **Claude Sonnet：** 你的“高级前端/重构专家”。用于根据截图生成组件、大规模文件重构、编写标准业务逻辑。
3. **Gemini 3 Pro：** 你的“深思熟虑的架构师”。用于处理超长上下文（如厚重的 API 文档）、排查深层逻辑 Bug（如并发问题）、以及架构与安全自查。

---

## 第四阶段：数据库与接口设计 (DB & API Design)
1. 开发者必须先规划实体关系图 (ER Diagram)，可使用 AI 辅助生成 SQL Schema。
2. 在编写核心逻辑前，必须先定义好前后端交互的 JSON 数据接口规范。

---

## 第五阶段：安全分级与代码审查 (Security & Code Review)
**⚠️ 开发纪律 (君子协定)：**
为了保持团队的高效与自由度，公司**未在系统层面锁定 main 分支**。但这代表着更高的责任：**绝对严禁任何人直接将代码 Push 到 main 分支。** 所有的代码合并必须通过 Pull Request (PR) 并等待自动化检查通过（显示绿勾）！

各级别审查要求如下：
- 🛡️ **Level 1 (低风险 - 内部普通工具)：**
  - **要求：** 必须通过 CI/CD 的代码格式化检查 (Prettier/ESLint/PHP_CodeSniffer) 及开源安全扫描 (如 Trivy, npm audit, PHPStan)。CI 通过后可自行 Merge。
- 🛡️ **Level 2 (中风险 - 公开资讯 / 内部高权限工具)：**
  - **要求：** 必须通过自动化检查，**并且**要求开发者使用 AI (Gemini/Claude) 进行边界条件辅助自查。涉及核心权限的 PR 需由同事进行 Peer Review。
- 🛡️ **Level 3 (高风险 - 涉及资金/极敏感数据)：**
  - **要求：** 在自动化与 AI 审查的基础上，**强制要求**所有涉及交易、扣费、并发处理的代码，必须由 Tech Lead 亲自进行人工 Code Review 并 Approve 后方可 Merge。
